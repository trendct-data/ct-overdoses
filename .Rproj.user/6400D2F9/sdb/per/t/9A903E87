{
    "contents" : "library(RCurl)\nlibrary(dplyr)\nlibrary(trendct)\nlibrary(ctnamecleaner)\nlibrary(lubridate)\nlibrary(stringr)\nlibrary(ggplot2)\n\n# Getting the CSV\nthe_csv <- getURL(\"https://data.ct.gov/api/views/rybz-nyjw/rows.csv?accessType=DOWNLOAD\")\noverdoses <- read.csv(textConnection(the_csv), stringsAsFactors=FALSE)\n\n# Total overdoses\ntotal <- nrow(overdoses)\n\n# Average age of overdoser \navg_age <- mean(overdoses$Age, na.rm=TRUE)\n\n# Convert the date to the proper format\noverdoses$Date <- mdy(overdoses$Date)\n\noverdoses$Year <- year(overdoses$Date)\ntable(overdoses$Year)\n\noverdoses$Heroin <- str_trim(overdoses$Heroin)\n\ntable(overdoses$Heroin)\n\n# Location!\n\nSouthington, CT (41.600428, -72.878105)\n\noverdoses$lat <- sub(\".*\\\\(\",\"\", overdoses$DeathLoc)\noverdoses$lat <- sub(\",.*\",\"\", overdoses$lat)\noverdoses$lng <- sub(\".*\\\\(\",\"\", overdoses$DeathLoc)\noverdoses$lng <- sub(\".*\\\\ \",\"\", overdoses$lng)\noverdoses$lng <- sub(\"\\\\)\",\"\", overdoses$lng)\n\nlibrary(leaflet)\n\nm <- leaflet(overdoses) %>% addTiles('http://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}.png') %>% setView(-72.878105, 41.600428, zoom=8) %>% \n  addCircles(~lng, ~lat, popup=overdoses$ImmediateCauseA, weight=3, radius=40,\n             color=\"#ffa500\", stroke=TRUE, fillOpacity=.8)\nm\n\n## OK, that's no good.\n\n# Let's choropleth it\n\nct_only <- subset(overdoses, (Residence.State==\"CT\" | Residence.State==\"\"))\n\n\noutside_ct <- subset(overdoses, Residence.State!=\"CT\")\nchoropleth_res <- data.frame(table(ct_only$Residence.City))\n\ncolnames(choropleth_res) <- c(\"Town\", \"Overdoses\")\n\nchoropleth_death <- data.frame(table(ct_only$Death.City))\n  \ncolnames(choropleth_death) <- c(\"Town\", \"Overdoses\")\n\ntop10 <- head(choropleth_res[order(-choropleth_res$Overdoses),], 10)\n\nrownames(top10) <- NULL\ntop10$Town <- as.character(top10$Town)\ntop10[6,1] <- \"unspecified\"\n\ntrendchart(top10, headline = \"Towns with the most overdoses in Connecticut\", subhead = \"Between 2012 and Sept. 2015\", src = \"State Medical Examiner's Office\",\n           byline = \"TrendCT.org\", type = \"column\", xTitle = \"\", yTitle = \"\",\n           xSuffix = \"\", ySuffix = \"\", xPrefix = \"\", yPrefix = \"\", option = \"\")\n\ntop10d <- head(choropleth_death[order(-choropleth_death$Overdoses),], 10)\ntop10d$Town <- as.character(top10$Town)\n\ntrendchart(top10d, headline = \"Towns with the most overdoses in Connecticut city.death\", subhead = \"Between 2012 and Sept. 2015\", src = \"State Medical Examiner's Office\",\n           byline = \"TrendCT.org\", type = \"column\", xTitle = \"\", yTitle = \"\",\n           xSuffix = \"\", ySuffix = \"\", xPrefix = \"\", yPrefix = \"\", option = \"\")\n\nchoropleth_death$Town <- str_trim(choropleth_death$Town)\nctnamecleaner(Town, choropleth_death, filename=\"analysis\", case=\"Title\")\n\nchoropleth_death <- subset(choropleth_death, Town!=\"\")\nchoropleth_death <- subset(choropleth_death, Town!=\"North Grosvenordale\")\n\nchoropleth_death <- read.csv(\"analysis.csv\")\n\nchoropleth_death <- choropleth_death[!is.na(choropleth_death$real.town.name),]\n\nchoropleth_death <- data.frame(tapply(choropleth_death$Overdoses, choropleth_death$real.town.name, sum))\n\nchoropleth_death$Town <- rownames(choropleth_death)\n\nrownames(choropleth_death) <- NULL\n\ncolnames(choropleth_death) <- c(\"Overdoses\", \"Town\")\nchoropleth_death <- choropleth_death[c(\"Town\", \"Overdoses\")]\n\nchoropleth_death[134,1] <- \"Wethersfield\"\n\ntrendmap(choropleth_death, headline=\"Accidental drug overdoes by town\", subhead=\"Between 2012 and Sept. 2015\",\n         src=\"State Medical Examiner's Office\", byline=\"TrendCT.org\", url_append=\"date\", shape=\"towns\", color=\"yellow-red\")\n\n\nstr(choropleth_death)\n",
    "created" : 1450668167635.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "737097734",
    "id" : "9A903E87",
    "lastKnownWriteTime" : 1450728658,
    "path" : "~/Documents/Github/ct_overdoses/overdoses.R",
    "project_path" : "overdoses.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "type" : "r_source"
}